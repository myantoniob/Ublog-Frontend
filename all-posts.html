<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="index.css">
    <title>Ublog - All posts</title>
  </head>
  <body>
    <!-- Navbar -->
        <nav id="profile" class="navbar navbar-dark bg-dark ">
          <a class="navbar-brand" href="#">
            <img src="assets/images/logo3.jpg" alt="logo de la mepresa">
            UBlog - News Feed 
          </a>
          <ul class="nav nav-tabs offset-md-3">
          
            <li class="nav-item">
              <a id="allPostNewPost" class="nav-link " aria-current="page" href="#" >New post  </a>
            </li>
            
            <li class="nav-item">
              <a id="allPostPerfil" class="nav-link" href="#">Perfil </a>
            </li>
          </ul>
        </nav>
    <!-- /Navbar -->
    
    <!-- Publicaciones-->
    <section id="allposts">
      <div class="container">
        <div  id="allpublicaciones" class="row pt-5 pb-5">  
          
         
        </div >
      </div>
    </section>
    <!-- /Publicaciones-->    


    <!-- Sript personalizadop -->
        <script>
          const queryStr = window.location.search;
          const urlParams = new URLSearchParams(queryStr);
          const name = urlParams.get("name");
          const gender = urlParams.get("gender");
          const nickname = urlParams.get("nickname");
          const email = urlParams.get("email");
          const password = urlParams.get("password");

          cargarTados();
          function cargarTados(){

            let allpublicaciones = document.getElementById("allpublicaciones");
          fetch("http://localhost:5000/release", {method: "GET"})
          .then((response) => response.json())
          .then((data) => {
            allpublicaciones.innerHTML = "";
            data.forEach((publicacion) => {
              let div_1 = document.createElement("div");
              div_1.className = "col-3 mb-5";

              let div_2 = document.createElement("div");
              div_2.className = "card";

              let typo = "";
              
              if(publicacion["type"] == "videos"){
                typo = document.createElement("iframe");
                typo.setAttribute("width","260px");
                typo.setAttribute("height", "200px");
                typo.src = publicacion.url;
                typo.setAttribute("title", "YouTube video player");
                typo.setAttribute("frameborder", "0");
                typo.setAttribute("allow", "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture");
                //typo.setAttribute("allowfullscreen");

            
              }else {
                typo = document.createElement("img");
                typo.className = "card-img-top";
                typo.src = publicacion.url;
              }
              

              let div_3 = document.createElement("div");
              div_3.className = "card-body row";

              let col_1 = document.createElement("div");
              col_1.className = "col-5";

              let anchor = document.createElement("button");
              anchor.setAttribute("type", "button");
              anchor.id = publicacion["id"];
              anchor.className = "btn btn-light ps-1 pe-1";
              anchor.innerText = "Like";

              let span = document.createElement("span");
              span.className = "badge bg-secondary ms-2";
              span.innerText = publicacion["cantidad"];
               console.log("Antes "+publicacion["cantidad"]); 
              let col_2 = document.createElement("div");
              col_2.className = "col-7";

              let label_1 = document.createElement("label");
              label_1.innerText = publicacion["nickname"]+"- ["+publicacion["date"]+"]";


              //---------------------
              console.log(publicacion["id"]);
             
              anchor.addEventListener("click", (e)=> {
                fetch("http://localhost:5000/increment", {
                  method: "POST",
                  headers: {"content-type": "application/json"},
                  body: JSON.stringify({"id": publicacion["id"],"nickname": publicacion["nickname"]}),
                })
                .then((response) => response.json())
                .then((data) => cargarTados())
              });

              //---------------------


              anchor.appendChild(span);
              col_1.appendChild(anchor);
              col_2.appendChild(label_1);
              
              div_3.appendChild(col_1);
              div_3.appendChild(col_2);
          
              div_2.appendChild(typo);
              div_2.appendChild(div_3);
              div_1.appendChild(div_2);
              allpublicaciones.appendChild(div_1);
			
            })    
          }) 

          }
          
          

          let allPostNewPost = document.getElementById("allPostNewPost");
          allPostNewPost.addEventListener("click", (e)=> {
            let params = `name=${name}`;
            params += `&gender=${gender}`;
            params += `&nickname=${nickname}`;
            params += `&email=${email}`;
            params += `&password=${password}`;
            window.location = "new-post.html?"+params;
          });

          let allPostPerfil = document.getElementById("allPostPerfil");
          allPostPerfil.addEventListener("click", (e)=> {
              console.log(nickname == "admin");
            if(nickname == "admin"){
              let params = `name=${name}`;
            params += `&gender=${gender}`;
            params += `&nickname=${nickname}`;
            params += `&email=${email}`;
            params += `&password=${password}`;
            window.location = "admin.html?"+params;

            }else{
              let params = `name=${name}`;
            params += `&gender=${gender}`;
            params += `&nickname=${nickname}`;
            params += `&email=${email}`;
            params += `&password=${password}`;
            window.location = "profile.html?"+params;

            }

            

          });

        </script>
    <!-- /Sript personalizadop -->

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    -->
  </body>
</html>